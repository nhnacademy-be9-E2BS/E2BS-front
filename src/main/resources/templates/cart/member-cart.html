<!--장바구니-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/user-layout}">

<head>
    <style>
        .product-link {
            color: inherit;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .product-link:hover {
            color: #007bff;
            text-decoration: underline;
        }
        .product-title-wrapper {
            font-weight: 500;          /* 글씨 진하게 */
            color: #333;               /* 진한 색상으로 */
            width: 150px;              /* 원하는 고정 너비 설정 */
            white-space: nowrap;       /* 텍스트 줄바꿈 방지 */
            overflow: hidden;          /* 넘치는 텍스트 숨김 */
            text-overflow: ellipsis;   /* 넘치는 텍스트 생략 (...) 처리 */
        }
    </style>
</head>

<body>
<div layout:fragment="content">

    <!--================Cart Area =================-->
    <section class="cart_area">
      <div class="container">
          <div class="cart_inner">
              <div class="table-responsive">
                  <div class="cart-header d-flex justify-content-between align-items-center mb-3">
                      <h3>장바구니</h3>
                      <button type="button"
                              class="btn btn-danger btn-sm"
                              id="clear-cart-btn">
                          <i class="ti-trash"></i> 비우기
                      </button>
                  </div>

                  <table class="table" style="text-align: center;">
                      <thead>
                          <tr>
                              <th>상품명</th>
                              <th>판매가</th>
                              <th>수량</th>
                              <th>합계</th>
                              <th>삭제</th>
                              <th>
                                  <input type="checkbox" id="select-all" checked />
                              </th>
                          </tr>
                      </thead>
                      <tbody id="cart-container">
                          <tr th:each="cartItem : ${cartItemsByMember}">
                              <td>
                                  <div class="media">
                                      <div class="d-flex">
                                          <img th:src="@{${cartItem.productImagePath}}" src="/img/cart/cart2.png" alt="" style="width: 100px; height: 150px;"
                                               onerror="src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIU-UceDHDzvuE5Gp1xYX0irHtgIWTeWwzlPVvLegZoes3vFaKT736CE8&s'">
                                      </div>
                                      <div class="media-body product-title-wrapper">
                                          <a th:href="@{/books/{productId}(productId=${cartItem.productId})}" class="product-link">
                                              <p th:text="${cartItem.productTitle}">상품명1</p>
                                          </a>
                                      </div>
                                  </div>
                              </td>

                              <td>
                                  <h5 class="unit-price" th:text="${#numbers.formatInteger(cartItem.productSalePrice, 3, 'COMMA')} + '원'">30000</h5>
                              </td>

                              <td>
                                  <div class="product_count">
                                      <input type="text"
                                             name="qty" class="input-text qty"
                                             th:id="'quantity-' + ${cartItem.productId}"
                                             th:value="${cartItem.cartItemsQuantity}" readonly>

                                      <button type="button"
                                              class="increase items-count"
                                              th:data-productid="${cartItem.productId}"
                                              th:data-cartitemsid="${cartItem.cartItemsId}">
                                          <i class="fas fa-plus"></i>
                                      </button>

                                      <button type="button"
                                              class="reduced items-count"
                                              th:data-productid="${cartItem.productId}"
                                              th:data-cartitemsid="${cartItem.cartItemsId}">
                                          <i class="fas fa-minus"></i>
                                      </button>
                                  </div>
                              </td>

                              <td>
                                  <h5 class="total-price" th:text="${#numbers.formatInteger(cartItem.productTotalPrice, 3, 'COMMA')} + '원'">30,000원</h5>
                              </td>

                              <td>
                                  <button type="button"
                                          class="delete-item-btn"
                                          th:data-cartitemsid="${cartItem.cartItemsId}"
                                          style="background: none; border: none;">
                                      <i class="ti-trash" style="color: #dc3545;"></i>
                                  </button>
                              </td>

                              <td>
                                  <input type="checkbox" class="cart-item-checkbox" checked
                                         th:data-product-id="${cartItem.productId}" />
                              </td>
                          </tr>

                          <tr th:if="${not #lists.isEmpty(cartItemsByMember)}">
                              <td colspan="4" style="text-align: right"><h5>결제 예정 금액</h5></td>
                              <td colspan="2" ><h5 class="total-payment-price" id="totalPaymentAmount"
                                                   th:text="${#numbers.formatInteger(totalPaymentAmount, 3, 'COMMA')} + '원'">30,000원</h5></td>
                          </tr>

                          <tr th:if="${not #lists.isEmpty(cartItemsByMember)}" class="out_button_area">
                              <td colspan="6" style="text-align: right">
                                  <div class="checkout_btn_inner">
                                      <button id="order-btn" type="button" class="primary-btn">주문하기</button>
                                  </div>
                              </td>
                          </tr>

                          <tr th:if="${#lists.isEmpty(cartItemsByMember)}">
                              <td colspan="6" style="text-align:center;">
                                  장바구니가 비어 있습니다.
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>
    </section>
    <!--================End Cart Area =================-->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script th:src="@{/js/cart/member/member-cart-add.js}"></script> <!--Thymeleaf 사용 시 더 안전한 방법: 이 방식은 애플리케이션이 /myapp 같은 서브 컨텍스트 경로에 배포돼도 자동 처리된다.-->
    <script th:src="@{/js/cart/member/member-cart-update-quantity.js}"></script>
    <script th:src="@{/js/cart/member/member-cart-delete.js}"></script>
    <script th:src="@{/js/cart/member/member-cart-order.js}"></script>
</div>
</body>
</html>