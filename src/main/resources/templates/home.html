<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/user-layout}">

<head>
    <title>E2BS</title>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .today-book-section {
            background: #f4f3f7;
            padding: 60px 10%;
        }

        .section-title {
            margin-bottom: 60px;
        }

        .section-title h2 {
            display: inline-block;
            font-size: 40px;
            font-weight: 700;
            margin-right: 16px;
        }

        .section-title span {
            color: #888;
            font-size: 16px;
        }

        .today-book-container {
            display: flex;
            gap: 60px;
            align-items: flex-start;
        }

        .main-book {
            display: flex;
            gap: 30px;
            flex: 1.5;
        }

        .main-book-img {
            width: 220px;
            height: auto;
            border-radius: 8px;
            object-fit: cover;
        }

        .main-book-info {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            max-width: 400px;
        }

        .book-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .book-meta {
            font-size: 14px;
            color: #555;
            margin-bottom: 12px;
        }

        .book-meta .dot {
            margin: 0 8px;
        }

        .book-desc {
            font-size: 14px;
            color: #444;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .book-price {
            font-size: 18px;
            font-weight: 600;
        }

        .sub-books {
            display: flex;
            flex: 1;
            gap: 24px;
            justify-content: flex-end;
        }

        .sub-book {
            text-align: center;
            width: 180px;
        }

        .sub-book img {
            width: 100%;
            border-radius: 6px;
            background: #eee;
        }

        .sub-title {
            font-size: 14px;
            margin-top: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }



    </style>


</head>


<body>
<div layout:fragment="content">
    <section class="today-book-section">
        <div class="section-title">
            <h2>오늘의 책</h2>
            <span>오늘 함께할 책을 만나보세요.</span>
        </div>

        <div class="today-book-container" th:if="${BestSellerList.size() > 0}">
            <!-- 대표 도서 -->
            <div class="main-book">
                <img class="main-book-img" th:src="@{${BestSellerList[0].productImage}}" alt="대표도서 이미지">
                <div class="main-book-info">
                    <h3 class="book-title" th:text="${BestSellerList[0].productTitle}">도서 제목</h3>
                    <p class="book-meta">
                        <span th:text="${BestSellerList[0].contributorName}">저자</span>
                        <span class="dot">·</span>
                        <span>창비</span> <!-- 출판사 정보가 없다면 하드코딩 -->
                    </p>
                    <p class="book-desc">
                        작품마다 치밀한 취재와 정교한 구성을 바탕으로 한 개성적인 캐릭터와 강렬하고도 서늘한 서사로
                        평단과 독자의 주목을 고루 받으며 새로운 세대의 리얼리즘을 열어가고 있다 평가받는 작가 성해나가
                        두번째 소설집 『혼모노』를 선보인다.
                    </p>
                    <p class="book-price" th:text="'₩' + ${#numbers.formatInteger(BestSellerList[0].productSalePrice, 3, 'COMMA')}">가격</p>
                </div>
            </div>

            <!-- 서브 도서들 -->
            <div class="sub-books">
                <div class="sub-book"
                     th:each="book, stat : ${BestSellerList}"
                     th:if="${stat.index >= 1 and stat.index <= 4}">
                    <img th:src="@{${book.productImage}}" alt="서브 도서 이미지">
                    <p class="sub-title" th:text="${book.productTitle}">서브 제목</p>
                </div>
            </div>
        </div>
    </section>



    <div class="main_best">
        <section class="bestseller">
            <div class="title_best">
                <h3 class="title_h3" style="margin-bottom: 60px;">
                    <a href="/books/category/1" class="title-link">베스트셀러</a>
                    <span> 이주의 가장 인기 있는 도서를 만나보세요.</span>
                </h3>
            </div>

            <div id="best_book_list_1" class="bestBookArea">
                <div class="aw_type_box">
                    <div class="arrow_left_best">
                        <button class="aw_l" id="bestBnLt_1" onclick="leftBestSeller()">
                            <span class="ns">이전</span>
                            <span class="aw_count"></span>
                        </button>
                    </div>
                    <div class="arrow_right_best">
                        <button class="aw_r" id="bestBnRt_1">
                            <span class="ns">다음</span>
                            <span class="aw_count"></span>
                        </button>
                    </div>
                </div>
                <div class="swiper-container" id="bestList_1">
                    <ul class="swiper-wrapper">
                        <li class="swiper-slide best_book_list">
                            <ul class="ranking_list" data-book-index="0" id="bestSellerList">
                                <li th:each="product, chunkStat : ${BestSellerList}" th:if="${chunkStat.index} <= 3">
                                    <div class="books">
                                        <a th:href="@{'/books/' + ${product.productId}}" class="r_book">
                                            <div class="book_img">
<!--                                                <div class="lank_num"-->
<!--                                                     th:text="${chunkStat.index * 4 + stat.index + 1}">1-->
<!--                                                </div>-->
                                                <img th:src="@{${product.productImage}}" alt="도서 이미지">
                                            </div>
                                            <p class="best_book_list_title mt15" th:text="${product.productTitle}">
                                                도서
                                                제목</p>
                                            <p class="best_book_list_title"
                                               th:text="'₩' + ${product.productSalePrice}">
                                                가격</p>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <div class="pagination"></div>
                </div>
            </div>


            <!-- 장바구니 이동 모달 -->
            <div class="modal fade" id="cartConfirmModal" tabindex="-1" aria-labelledby="cartConfirmModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="cartConfirmModalLabel">장바구니에 담았습니다</h5>
                            <button type="button" class="btn-close" id="closeBtn" data-bs-dismiss="modal" aria-label="닫기"></button>
                        </div>
                        <div class="modal-body">
                            장바구니로 이동하시겠습니까?
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" id="continueBtn" data-bs-dismiss="modal">계속 쇼핑하기</button>
                            <button type="button" class="btn btn-primary" id="goToCartBtn">장바구니로 이동</button>
                        </div>
                    </div>
                </div>
            </div>
    </section>
</div>

<script type="text/javascript" th:inline="javascript">



    const bestList = /*[[${BestSellerList}]]*/ [];
    function leftBestSeller() {
        let list = document.getElementById("bestSellerList");
        let bookIndex = parseInt(list.dataset.bookIndex) - 1; //도서 각각 인덱스

        const lastIndex = Math.floor((bestList.length - 1) / 4);

        if(bookIndex < 0){
            // 마지막 인덱스로 초기화
            bookIndex = lastIndex;
        }
        list.innerHTML = "";

        let book = document.createElement('li');

        for(let i = bookIndex * 4; i < bookIndex * 4 + 4 ; i++){
            if (i >= bestList.length) break;

            let product = bestList[i];

            let booksDiv = document.createElement('div');
            booksDiv.classList.add('books');

            let link = document.createElement('a');
            link.classList.add('r_book');
            link.href = '/books/${product.productId}}'

            let imgDiv = document.createElement('div');
            imgDiv.classList.add('book_img');

            let img = document.createElement('img');
            img.src = product.productImage;
            img.alt = "도서 이미지";

            imgDiv.appendChild(img);
            link.appendChild(imgDiv);

            let titleP = document.createElement('p');
            titleP.classList.add('best_book_list_title', 'mt15');
            titleP.textContent = product.productTitle;

            let priceP = document.createElement('p');
            titleP.classList.add('best_book_list_title');
            titleP.textContent = product.productSalePrice;

            link.appendChild(titleP);
            link.appendChild(priceP);

            booksDiv.appendChild(link);
            book.appendChild(booksDiv);
        }

    }

</script>

</div>
</body>
</html>